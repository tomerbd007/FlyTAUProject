{% extends "base.html" %}

{% block title %}Select Seats - {{ flight.FlightId }} - FLYTAU{% endblock %}

{% block content %}
<div class="page-header">
    <a href="{{ url_for('flight_detail', flight_id=flight.FlightId) }}?airplane_id={{ flight.Airplanes_AirplaneId }}&passengers={{ request.args.get('passengers', '1') }}" 
       class="back-link">← Back to flight details</a>
    <h1>Select Your Seats</h1>
    <p>Flight {{ flight.FlightId }}: {{ flight.OriginPort }} → {{ flight.DestPort }}</p>
</div>

<div class="seat-selection-container">
    <div class="seat-map-section">
        <div class="seat-legend">
            <div class="legend-item">
                <span class="seat-demo seat-available"></span>
                <span>Available</span>
            </div>
            <div class="legend-item">
                <span class="seat-demo seat-occupied"></span>
                <span>Occupied</span>
            </div>
            <div class="legend-item">
                <span class="seat-demo seat-selected"></span>
                <span>Selected</span>
            </div>
        </div>
        
        <div class="class-legend">
            <span class="class-tag business">Business</span>
            <span class="class-tag economy">Economy</span>
        </div>
        
        <form method="POST" action="{{ url_for('seat_selection', flight_id=flight.FlightId) }}?airplane_id={{ flight.Airplanes_AirplaneId }}" id="seat-form">
            <input type="hidden" name="passengers" value="{{ request.args.get('passengers', '1') }}">
            
            <div class="aircraft-cabin">
                <div class="cabin-front">
                    <div class="cockpit"></div>
                </div>
                
                {# Business Class Section #}
                {% if seat_map and seat_map.business and seat_map.business.rows %}
                <div class="class-divider">
                    <span>Business Class</span>
                </div>
                {% for row_num, seats in seat_map.business.rows.items() %}
                <div class="seat-row">
                    <span class="row-number">{{ row_num }}</span>
                    <div class="seats-group">
                        {% for seat in seats %}
                        <label class="seat seat-business {% if seat.status == 'taken' %}seat-occupied{% endif %}"
                               title="Seat {{ seat.code }} - ${{ '%.2f'|format(flight.BusinessPrice|float) }}">
                            <input type="checkbox" 
                                   name="seats" 
                                   value="{{ seat.code }}"
                                   {% if seat.status == 'taken' %}disabled{% endif %}
                                   data-price="{{ flight.BusinessPrice }}"
                                   data-class="business">
                            <span class="seat-label">{{ seat.col }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
                {% endif %}
                
                {# Economy Class Section #}
                {% if seat_map and seat_map.economy and seat_map.economy.rows %}
                <div class="class-divider">
                    <span>Economy Class</span>
                </div>
                {% for row_num, seats in seat_map.economy.rows.items() %}
                <div class="seat-row">
                    <span class="row-number">{{ row_num }}</span>
                    <div class="seats-group">
                        {% for seat in seats %}
                        <label class="seat seat-economy {% if seat.status == 'taken' %}seat-occupied{% endif %}"
                               title="Seat {{ seat.code }} - ${{ '%.2f'|format(flight.EconomyPrice|float) }}">
                            <input type="checkbox" 
                                   name="seats" 
                                   value="{{ seat.code }}"
                                   {% if seat.status == 'taken' %}disabled{% endif %}
                                   data-price="{{ flight.EconomyPrice }}"
                                   data-class="economy">
                            <span class="seat-label">{{ seat.col }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
            
            <div class="selection-summary">
                <div class="summary-info">
                    <p>Select your seat{{ 's' if (request.args.get('passengers', '1')|int) > 1 else '' }}</p>
                    <p class="selected-count">Selected: <span id="selected-seats-count">0</span></p>
                    <p class="total-price">Total: $<span id="total-price">0.00</span></p>
                </div>
                
                <div class="summary-actions">
                    <button type="submit" class="btn btn-primary btn-lg">
                        Continue to Checkout
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="pricing-info-sidebar">
        <h3>Pricing</h3>
        <ul class="price-list">
            <li>
                <span class="class-name">Business Class</span>
                <span class="price">${{ "%.2f"|format(flight.BusinessPrice|float) }}</span>
            </li>
            <li>
                <span class="class-name">Economy Class</span>
                <span class="price">${{ "%.2f"|format(flight.EconomyPrice|float) }}</span>
            </li>
        </ul>
        
        <div class="info-box">
            <h4>Cancellation Policy</h4>
            <p>Free cancellation up to 36 hours before departure. A 5% cancellation fee applies after that.</p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('input[name="seats"]');
    const countDisplay = document.getElementById('selected-seats-count');
    const priceDisplay = document.getElementById('total-price');
    
    function updateSummary() {
        let count = 0;
        let total = 0;
        
        checkboxes.forEach(cb => {
            if (cb.checked) {
                count++;
                total += parseFloat(cb.dataset.price) || 0;
            }
        });
        
        countDisplay.textContent = count;
        priceDisplay.textContent = total.toFixed(2);
    }
    
    checkboxes.forEach(cb => {
        cb.addEventListener('change', updateSummary);
    });
});
</script>
{% endblock %}
