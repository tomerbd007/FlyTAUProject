{% extends "base.html" %}

{% block title %}{{ report_title }} - FLYTAU Admin{% endblock %}

{% block content %}
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        background: #f5f5f5;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: #333;
    }

    .dashboard-wrapper { display: flex; min-height: 100vh; }

    .dashboard-wrapper::before {
        content: '';
        position: fixed;
        left: 0; top: 0;
        width: 25%; height: 100vh;
        background: linear-gradient(135deg, #1a3a52 0%, #2d5a7b 100%);
        z-index: 0;
    }

    .dashboard-sidebar {
        width: 25%;
        padding: 40px 30px;
        color: white;
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1;
    }

    .dashboard-sidebar .logo { font-size: 2rem; font-weight: 700; margin-bottom: 40px; letter-spacing: -1px; }

    .sidebar-welcome { margin-bottom: 30px; }
    .sidebar-welcome h2 { font-size: 1.5rem; font-weight: 300; margin-bottom: 8px; line-height: 1.3; }
    .sidebar-welcome p { font-size: 0.95rem; opacity: 0.85; line-height: 1.6; }

    .sidebar-actions { display: flex; flex-direction: column; gap: 12px; margin-top: 30px; }
    .sidebar-actions .btn {
        width: 100%; padding: 12px 16px; border: 1px solid rgba(255,255,255,0.3);
        border-radius: 4px; background: transparent; color: white; font-size: 0.9rem; font-weight: 600;
        cursor: pointer; transition: all 0.3s ease; text-decoration: none; text-align: center;
    }
    .sidebar-actions .btn:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.5); }

    .dashboard-content {
        width: 75%; margin-left: 25%; padding: 40px; background: white;
        position: relative; z-index: 1; min-height: 100vh;
    }

    .admin-header { margin-bottom: 32px; }
    .admin-header h1 { font-size: 2.2rem; font-weight: 600; color: #1a3a52; margin-bottom: 10px; }
    .admin-header p { font-size: 0.95rem; color: #888; }

    .report-container { display: flex; flex-direction: column; gap: 24px; }

    /* Summary Stats */
    .report-summary {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }
    .summary-stat {
        background: linear-gradient(135deg, #1a3a52 0%, #2d5a7b 100%);
        padding: 20px 28px;
        border-radius: 10px;
        color: white;
        min-width: 180px;
    }
    .stat-value { display: block; font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; }
    .stat-label { display: block; font-size: 0.9rem; opacity: 0.85; }

    /* Chart Section */
    .chart-section {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 24px;
        text-align: center;
    }
    .chart-section img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
    }

    /* Data Table */
    .table-section {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
    }
    .table-header {
        padding: 16px 20px;
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
    }
    .table-header h2 {
        font-size: 1.1rem;
        color: #1a3a52;
        margin: 0;
    }
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    .data-table th, .data-table td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #e8e8e8;
        font-size: 0.9rem;
    }
    .data-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #1a3a52;
        border-bottom: 2px solid #ddd;
    }
    .data-table tr:hover { background: #f9f9f9; }
    .data-table tr:last-child td { border-bottom: none; }

    /* Cell alignment */
    .text-right { text-align: right; }
    .text-center { text-align: center; }

    /* Table Footer */
    .table-footer {
        padding: 12px 20px;
        background: #f8f9fa;
        border-top: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: #666;
    }

    /* No Data Message */
    .no-data-message {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    .no-data-icon { font-size: 3rem; margin-bottom: 16px; }
    .no-data-message h2 { color: #1a3a52; margin-bottom: 8px; }
    .no-data-message p { color: #888; }

    @media (max-width: 1024px) {
        .dashboard-wrapper::before { width: 30%; }
        .dashboard-sidebar { width: 30%; }
        .dashboard-content { width: 70%; margin-left: 30%; padding: 30px; }
    }
    @media (max-width: 768px) {
        .dashboard-wrapper { flex-direction: column; }
        .dashboard-wrapper::before { width: 100%; height: 200px; }
        .dashboard-sidebar { width: 100%; height: auto; position: relative; padding: 30px 20px; }
        .dashboard-content { width: 100%; margin-left: 0; padding: 20px; }
        .report-summary { flex-direction: column; }
        .summary-stat { min-width: 100%; }
    }
</style>

<div class="dashboard-wrapper">
    <div class="dashboard-sidebar">
        <div class="logo">FLYTAU</div>
        <div class="sidebar-welcome">
            <h2>{{ report_title }}</h2>
            {% if report_description %}
            <p>{{ report_description }}</p>
            {% endif %}
        </div>
        <div class="sidebar-actions">
            <a href="{{ url_for('reports_index') }}" class="btn">‚Üê Back to Reports</a>
            <a href="{{ url_for('admin_dashboard') }}" class="btn">Dashboard</a>
            <a href="{{ url_for('logout') }}" class="btn">Logout</a>
        </div>
    </div>

    <div class="dashboard-content">
        <div class="admin-header">
            <h1>{{ report_title }}</h1>
            {% if report_description %}
            <p>{{ report_description }}</p>
            {% endif %}
        </div>

        <div class="report-container">
            {% if data %}
            
            {# Summary Statistics #}
            {% if summary %}
            <div class="report-summary">
                {% for item in summary %}
                <div class="summary-stat">
                    <span class="stat-value">{{ item.value }}</span>
                    <span class="stat-label">{{ item.label }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {# Chart Section - Only show if chart is provided #}
            {% if chart %}
            <div class="chart-section">
                <img src="{{ chart }}" alt="{{ report_title }} Chart">
            </div>
            {% endif %}
            
            {# Data Table #}
            <div class="table-section">
                <div class="table-header">
                    <h2>Detailed Data</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            {% for column in columns %}
                            <th class="{% if column.type in ['currency', 'percent', 'number'] %}text-right{% endif %}">
                                {{ column.label }}
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                        <tr>
                            {% for column in columns %}
                            <td class="{% if column.type in ['currency', 'percent', 'number'] %}text-right{% endif %}">
                                {% set value = row[column.key] %}
                                {% if column.type == 'currency' %}
                                    ${{ "%.2f"|format(value|float) if value else '0.00' }}
                                {% elif column.type == 'percent' %}
                                    {{ "%.1f"|format(value|float) if value else '0.0' }}%
                                {% elif column.type == 'number' %}
                                    {{ value if value else '0' }}
                                {% elif column.type == 'date' %}
                                    {{ value.strftime('%b %d, %Y') if value else '-' }}
                                {% elif column.type == 'month' %}
                                    {% if value %}
                                        {% set month_names = ['', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'] %}
                                        {% if value|int > 0 and value|int <= 12 %}
                                            {{ month_names[value|int] }}
                                        {% else %}
                                            {{ value }}
                                        {% endif %}
                                    {% else %}
                                        -
                                    {% endif %}
                                {% else %}
                                    {{ value if value else '-' }}
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="table-footer">
                    <span>{{ data|length }} row{{ 's' if data|length != 1 else '' }}</span>
                </div>
            </div>
            
            {% else %}
            {# No Data Message #}
            <div class="no-data-message">
                <div class="no-data-icon">üìä</div>
                <h2>No data available</h2>
                <p>There is no data to display for this report.</p>
                <p>This could be because there are no flights, orders, or crew assignments in the system yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
