{% extends "base.html" %}

{% block title %}My Orders - FLYTAU{% endblock %}

{% block content %}
<div class="page-header">
    <h1>My Orders</h1>
    <p>View and manage your flight bookings</p>
</div>

<div class="orders-container">
    <div class="orders-filter">
        <form method="GET" action="{{ url_for('my_orders') }}" class="filter-form">
            <label for="status">Filter by status:</label>
            <select name="status" id="status" onchange="this.form.submit()">
                <option value="">All Orders</option>
                <option value="confirmed" {% if request.args.get('status') == 'confirmed' %}selected{% endif %}>Confirmed</option>
                <option value="cancelled" {% if request.args.get('status') == 'cancelled' %}selected{% endif %}>Cancelled</option>
                <option value="completed" {% if request.args.get('status') == 'completed' %}selected{% endif %}>Completed</option>
            </select>
            <noscript>
                <button type="submit" class="btn btn-secondary btn-sm">Filter</button>
            </noscript>
        </form>
    </div>
    
    {% if orders %}
    <div class="orders-list">
        {% for order in orders %}
        <div class="order-card">
            <div class="order-header">
                <div class="booking-info">
                    <span class="booking-code">{{ order.booking_code }}</span>
                    <span class="order-date">Booked on {{ order.created_at.strftime('%b %d, %Y') }}</span>
                </div>
                <span class="order-status status-{{ order.status }}">{{ order.status|capitalize }}</span>
            </div>
            
            <div class="order-flight">
                <div class="flight-route-mini">
                    <span class="origin">{{ order.origin }}</span>
                    <span class="arrow">â†’</span>
                    <span class="destination">{{ order.destination }}</span>
                </div>
                <div class="flight-datetime">
                    {{ order.departure_time.strftime('%a, %b %d, %Y at %H:%M') }}
                </div>
                <div class="flight-number">Flight {{ order.flight_number }}</div>
            </div>
            
            <div class="order-summary">
                <span class="ticket-count">{{ order.ticket_count }} ticket{{ 's' if order.ticket_count > 1 else '' }}</span>
                <span class="order-total">${{ "%.2f"|format(order.total_amount) }}</span>
            </div>
            
            <div class="order-actions">
                <a href="{{ url_for('order_detail', order_id=order.id) }}" class="btn btn-secondary btn-sm">
                    View Details
                </a>
                {% if order.status == 'confirmed' and order.can_cancel %}
                <a href="{{ url_for('cancel_order', order_id=order.id) }}" class="btn btn-danger btn-sm">
                    Cancel Order
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-orders">
        <div class="no-orders-icon">ðŸ“‹</div>
        <h2>No orders found</h2>
        {% if request.args.get('status') %}
        <p>No {{ request.args.get('status') }} orders found.</p>
        <a href="{{ url_for('my_orders') }}" class="btn btn-secondary">View All Orders</a>
        {% else %}
        <p>You haven't made any bookings yet.</p>
        <a href="{{ url_for('flight_search') }}" class="btn btn-primary">Search Flights</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
