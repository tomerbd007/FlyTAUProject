{% extends "base.html" %}

{% block title %}Manage Flights - FLYTAU Admin{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Manage Flights</h1>
    <a href="{{ url_for('add_flight_step1') }}" class="btn btn-primary">+ Add New Flight</a>
</div>

<div class="flights-management">
    <div class="filter-bar">
        <form method="GET" action="{{ url_for('admin_flights') }}" class="filter-form">
            <div class="filter-group">
                <label for="status">Status:</label>
                <select name="status" id="status">
                    <option value="">All Statuses</option>
                    <option value="scheduled" {% if request.args.get('status') == 'scheduled' %}selected{% endif %}>Scheduled</option>
                    <option value="departed" {% if request.args.get('status') == 'departed' %}selected{% endif %}>Departed</option>
                    <option value="arrived" {% if request.args.get('status') == 'arrived' %}selected{% endif %}>Arrived</option>
                    <option value="cancelled" {% if request.args.get('status') == 'cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="date_from">From:</label>
                <input type="date" name="date_from" id="date_from" value="{{ request.args.get('date_from', '') }}">
            </div>
            
            <div class="filter-group">
                <label for="date_to">To:</label>
                <input type="date" name="date_to" id="date_to" value="{{ request.args.get('date_to', '') }}">
            </div>
            
            <button type="submit" class="btn btn-secondary btn-sm">Apply Filters</button>
            <a href="{{ url_for('admin_flights') }}" class="btn btn-ghost btn-sm">Clear</a>
        </form>
    </div>
    
    {% if flights %}
    <div class="flights-table-container">
        <table class="data-table flights-table">
            <thead>
                <tr>
                    <th>Flight #</th>
                    <th>Route</th>
                    <th>Departure</th>
                    <th>Aircraft</th>
                    <th>Status</th>
                    <th>Bookings</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for flight in flights %}
                <tr class="{% if flight.status == 'cancelled' %}row-cancelled{% endif %}">
                    <td>
                        <strong>{{ flight.flight_number }}</strong>
                    </td>
                    <td>
                        <div class="route-cell">
                            <span class="origin">{{ flight.origin }}</span>
                            <span class="arrow">‚Üí</span>
                            <span class="destination">{{ flight.destination }}</span>
                        </div>
                    </td>
                    <td>
                        <div class="datetime-cell">
                            <span class="date">{{ flight.departure_time.strftime('%b %d, %Y') }}</span>
                            <span class="time">{{ flight.departure_time.strftime('%H:%M') }}</span>
                        </div>
                    </td>
                    <td>{{ flight.aircraft_type }}</td>
                    <td>
                        <span class="status-badge status-{{ flight.status }}">
                            {{ flight.status|capitalize }}
                        </span>
                    </td>
                    <td>
                        <div class="bookings-cell">
                            <span class="booked">{{ flight.booked_seats }}</span> / 
                            <span class="total">{{ flight.total_seats }}</span>
                            <div class="mini-bar">
                                <div class="mini-fill" style="width: {{ (flight.booked_seats / flight.total_seats * 100)|int }}%"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('flight_detail', flight_id=flight.id) }}" 
                               class="btn btn-ghost btn-sm" title="View Details">
                                üëÅ
                            </a>
                            {% if flight.status == 'scheduled' and flight.can_cancel %}
                            <a href="{{ url_for('cancel_flight', flight_id=flight.id) }}" 
                               class="btn btn-ghost btn-sm btn-danger-ghost" title="Cancel Flight">
                                ‚úï
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="table-footer">
        <span class="result-count">Showing {{ flights|length }} flight{{ 's' if flights|length != 1 else '' }}</span>
    </div>
    {% else %}
    <div class="no-results">
        <div class="no-results-icon">‚úà</div>
        <h2>No flights found</h2>
        <p>No flights match your current filters.</p>
        <a href="{{ url_for('add_flight_step1') }}" class="btn btn-primary">Add New Flight</a>
    </div>
    {% endif %}
</div>
{% endblock %}
